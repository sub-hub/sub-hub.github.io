<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Size Analyzer</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>
<body>
    <div id="app-container">
        <header>
            <h1>JSON Size Analyzer</h1>
        </header>

        <main>
            <div id="upload-box">
                <div id="drop-zone">
                    <p>ì—¬ê¸°ì— JSON íŒŒì¼ì„ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ê±°ë‚˜, ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”.</p>
                    <input type="file" id="file-input" accept=".json" style="display: none;">
                    <button id="upload-button">íŒŒì¼ ì„ íƒ</button>
                    <button id="paste-clipboard-button"><span class="icon">ğŸ“‹</span> í´ë¦½ë³´ë“œì—ì„œ ë¶™ì—¬ë„£ê¸°</button>
                </div>
            </div>

            <div id="view-toggle-buttons" class="hidden">
                <button id="toggle-tree-view" class="toggle-btn active" data-view="tree-panel">
                    <span class="icon">ğŸ“‚</span> êµ¬ì¡° ë¶„ì„ (Tree View)
                </button>
                <button id="toggle-treemap-view" class="toggle-btn" data-view="treemap-panel">
                    <span class="icon">ğŸ“Š</span> í¬ê¸° ë¶„í¬ (Treemap)
                </button>
            </div>

            <div id="analysis-container">
                <div class="panel hidden" id="tree-panel">
                    <div class="panel-header">
                        <div id="file-info"></div>
                    </div>
                    <div id="tree-container"></div>
                </div>
                <div class="panel hidden" id="treemap-panel">
                    <div id="treemap-container"></div>
                </div>
            </div>
            
            <div id="loading-overlay" class="hidden">
                <div class="spinner"></div>
                <p>íŒŒì¼ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>
        </main>
    </div>

    <script src="script.js"></script>
    <script>
        window.addEventListener('message', receiveData, false);

        function receiveData(event) {
            if (event.origin !== 'https://risuai.xyz') {
                console.warn('Ignoring message from untrusted origin:', event.origin);
                return;
            }

            const dbString = event.data;
            
            console.log('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì‹ í–ˆìŠµë‹ˆë‹¤.');

            try {
                const jsonData = JSON.parse(dbString);
                window.handleReceivedData(dbString);
                alert('Risu DB ë°ì´í„°ë¥¼ ë°›ì•„ ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤.');
            } catch(e) {
                console.error('ìˆ˜ì‹ í•œ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', e);
                alert('ìˆ˜ì‹ í•œ ë°ì´í„°ì— ì˜¤ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤.');
            }
        }
    </script>
</body>
</html>